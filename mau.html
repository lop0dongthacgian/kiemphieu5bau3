<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Bảng ghi nhóm phiếu bầu cử</title>
<style>
  body {
    font-family: "Times New Roman", Times, serif;
    margin: 0;
    padding: 0;
    background-color: #f0f2f5;
  }
  .page {
    width: 210mm;
    height: 297mm;
    margin: 10mm auto;
    padding: 20mm 15mm;
    background: white;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: space-around; 
    page-break-after: always;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    position: relative;
  }
  /* Style cho các bảng mẫu */
  .page-table {
    justify-content: center !important; /* Căn giữa bảng theo chiều dọc */
    align-items: center; /* Căn giữa theo chiều ngang */
  }
  .vote-group {
    text-align: center;
    font-size: 34pt;
    font-weight: bold;
    padding-bottom: 10mm;
    border-bottom: 1pt dashed #ddd;
    width: 100%;
    color: black;
  }
  .vote-group:last-child {
    border-bottom: none;
  }
  
  /* CSS cho Bảng */
  .table-container {
    width: 100%;
  }
  .table-title {
    text-align: center;
    font-weight: bold;
    font-size: 18pt;
    margin-bottom: 20px;
    text-transform: uppercase;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin: 0 auto;
  }
  th, td {
    border: 1.5pt solid black;
    padding: 12px 8px;
    text-align: center;
    font-size: 14pt;
  }
  th {
    background-color: #f2f2f2;
  }

  .footer-note {
    position: absolute;
    bottom: 10mm;
    left: 0;
    right: 0;
    text-align: center;
    font-style: italic;
    font-size: 12pt;
    color: #999;
  }
  .btn-container {
    text-align: center;
    padding: 20px;
    background: #fff;
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  .download-btn {
    padding: 15px 40px;
    background-color: #d32f2f;
    color: white;
    border: none;
    border-radius: 4px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
  }
  .back-btn {
    padding: 15px 30px;
    background: #f0f0f0;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
    cursor: pointer;
    font-weight: bold;
  }
  @media print {
    .btn-container { display: none; }
    body { background: none; }
    .page { margin: 0; box-shadow: none; }
  }
</style>
</head>
<body>

<div class="btn-container">
  <button class="download-btn" onclick="confirmDownload()">TẢI XUỐNG FILE WORD</button>
  <button class="back-btn" onclick="goBackToIndex()">← Quay về trang chủ</button>
</div>

<div id="print-area">
  <div class="page">
    <div class="vote-group">PHIẾU BẤT HỢP LỆ</div>
    <div class="vote-group">PHIẾU BẦU 1</div>
    <div class="vote-group">PHIẾU BẦU 2</div>
    <div id="ab-box" class="vote-group">GẠCH A và B</div>
    <div class="footer-note">Trang 1/6</div>
  </div>

  <div class="page">
    <div id="ac-box" class="vote-group">GẠCH A và C</div>
    <div id="ad-box" class="vote-group">GẠCH A và D</div>
    <div id="ae-box" class="vote-group">GẠCH A và E</div>
    <div id="bc-box" class="vote-group">GẠCH B và C</div>
    <div class="footer-note">Trang 2/6</div>
  </div>

  <div class="page">
    <div id="bd-box" class="vote-group">GẠCH B và D</div>
    <div id="be-box" class="vote-group">GẠCH B và E</div>
    <div id="cd-box" class="vote-group">GẠCH C và D</div>
    <div id="ce-box" class="vote-group">GẠCH C và E</div>
    <div class="footer-note">Trang 3/6</div>
  </div>

  <div class="page">
    <div id="de-box" class="vote-group">GẠCH D và E</div>
    <div class="vote-group"></div>
    <div class="vote-group"></div>
    <div class="vote-group"></div>
    <div class="footer-note">Trang 4/6</div>
  </div>

  <div class="page page-table">
    <div class="table-container">
        <div class="table-title">PHỤ LỤC 1: BẢNG KIỂM PHIẾU ĐƯỢC BẦU (KIỂM XUÔI)</div>
        <table>
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th style="width: 50%;">Họ và tên ứng cử viên</th>
                    <th style="width: 40%;">Số phiếu được bầu</th>
                </tr>
            </thead>
            <tbody id="table-bau-body"></tbody>
        </table>
    </div>
    <div class="footer-note">Trang 5/6</div>
  </div>

  <div class="page page-table">
    <div class="table-container">
        <div class="table-title">PHỤ LỤC 2: BẢNG KIỂM PHIẾU BỊ GẠCH (KIỂM NGƯỢC)</div>
        <table>
            <thead>
                <tr>
                    <th style="width: 10%;">STT</th>
                    <th style="width: 50%;">Cặp ứng viên bị gạch</th>
                    <th style="width: 40%;">Số phiếu</th>
                </tr>
            </thead>
            <tbody id="table-gach-body"></tbody>
        </table>
    </div>
    <div class="footer-note">Trang 6/6</div>
  </div>
</div>

<script src="config.js"></script>
<script>
function goBackToIndex() {
  if (confirm("Bạn có muốn quay về trang chủ không?")) {
    window.location.href = "index.html";
  }
}

function updateCandidateNames() {
  if (typeof candidates === 'undefined') return;

  const pairs = [
    { id: 'ab-box', keys: ['A', 'B'] }, { id: 'ac-box', keys: ['A', 'C'] },
    { id: 'ad-box', keys: ['A', 'D'] }, { id: 'ae-box', keys: ['A', 'E'] },
    { id: 'bc-box', keys: ['B', 'C'] }, { id: 'bd-box', keys: ['B', 'D'] },
    { id: 'be-box', keys: ['B', 'E'] }, { id: 'cd-box', keys: ['C', 'D'] },
    { id: 'ce-box', keys: ['C', 'E'] }, { id: 'de-box', keys: ['D', 'E'] }
  ];

  // Cập nhật nhãn trang 1-4
  pairs.forEach(pair => {
    const el = document.getElementById(pair.id);
    if (el) {
      el.textContent = `GẠCH ${candidates[pair.keys[0]]} và ${candidates[pair.keys[1]]}`;
    }
  });

  // Cập nhật Bảng Trang 5 (Kiểm xuôi)
  const bauBody = document.getElementById('table-bau-body');
  if (bauBody) {
    bauBody.innerHTML = '';
    Object.keys(candidates).forEach((key, index) => {
      bauBody.innerHTML += `<tr><td>${index + 1}</td><td style="text-align:left; padding-left:20px;">${candidates[key]}</td><td></td></tr>`;
    });
  }

  // Cập nhật Bảng Trang 6 (Kiểm ngược)
  const gachBody = document.getElementById('table-gach-body');
  if (gachBody) {
    gachBody.innerHTML = '';
    pairs.forEach((pair, index) => {
      const names = `${candidates[pair.keys[0]]} và ${candidates[pair.keys[1]]}`;
      gachBody.innerHTML += `<tr><td>${index + 1}</td><td style="text-align:left; padding-left:20px;">Gạch ${names}</td><td></td></tr>`;
    });
  }
}

function confirmDownload() {
  if (confirm("Bạn có muốn tải mẫu phiếu bầu dưới dạng Word không?")) {
    downloadWord();
  }
}

function downloadWord() {
  updateCandidateNames();
  const content = document.getElementById('print-area').innerHTML;
  const style = `
    <style>
      @page { size: A4; margin: 1cm; }
      table { width: 100%; border-collapse: collapse; }
      th, td { border: 1pt solid black; padding: 10px; text-align: center; font-family: "Times New Roman"; }
      .table-title { font-weight: bold; font-size: 16pt; text-align: center; margin-bottom: 15pt; }
      .vote-group { text-align: center; font-size: 28pt; font-weight: bold; padding: 40pt 0; border-bottom: 1pt dashed #ccc; display: block; width: 100%; }
      .page { page-break-after: always; clear: both; }
      .footer-note { text-align: center; font-size: 10pt; margin-top: 20pt; color: #999; }
    </style>`;
  const html = `<html><head><meta charset='utf-8'>${style}</head><body>${content}</body></html>`;
  const blob = new Blob(['\ufeff', html], { type: 'application/msword' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; 
  a.download = 'Mau_in.doc';
  document.body.appendChild(a); 
  a.click(); 
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

window.onload = updateCandidateNames;
</script>
</body>
</html>
